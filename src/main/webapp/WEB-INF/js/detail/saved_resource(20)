M.add("mt-map",function(a){var b,c,d=a.Node,e=a.Lang.isArray,f="google",g="qq";if(window.qq&&window.qq.maps)b=window.qq.maps,c=g;else{if(!window.google||!window.google.maps)throw new Error("Y.mt.Map: third-party map service supplier required");b=window.google.maps,c=f}var h=function(){h.superclass.constructor.apply(this,arguments)};h.NAME="MTMap",h.ATTRS={container:{value:null,setter:function(b){return a.one(b)},writeOnce:!0},map:{value:null},bounds:{value:null,setter:"_setBounds"},center:{value:[],setter:"_setCenter",getter:"_getCenter"},zoom:{value:0,validator:"_validateZoom",setter:"_setZoom",getter:"_getZoom"},defaultZoom:{value:13,validator:"_validateZoom",writeOnce:!0},markers:{value:[],setter:"_setMarkers"},infoWindows:{value:[],setter:"_setInfoWindows"},options:{value:{}}};var i={initializer:function(){this.publish("load",{fireOnce:!0,defaultFn:this._defLoadFn})},destructor:function(){var a=this.get("map");c===f?b.event.clearInstanceListeners(a):c===g&&b.event.clearListeners(a)},render:function(){if(this.get("container")){var a=this,c=a._getConfig(),e=d.getDOMNode(a.get("container")),f=a.get("infoWindows");a.set("map",new b.Map(e,c)),f&&a._initInfoWindow(),a._initMapEvent(),this.fitBounds()}},fitBounds:function(){var a=this.get("bounds");a&&this.get("markers").length>1&&this.get("map").fitBounds(a)},_getConfig:function(){var d,f,h,i=this,j=i.get("center"),k=i.get("zoom"),l=i.get("defaultZoom"),m=i.get("markers"),n=i.get("options");return e(j)&&2===j.length&&(j=new b.LatLng(j[0],j[1])),j instanceof b.LatLng?(d=j,f=0===k?l:k):(i.set("bounds",m),d=i.get("bounds").getCenter(),f=l),h={center:d,scrollwheel:!0,mapTypeId:b.MapTypeId.ROADMAP,mapTypeControl:!1,position:b.ControlPosition.TOP_RIGHT,panControl:!1,panControlOptions:{position:b.ControlPosition.LEFT_TOP},scaleControl:!1,scaleControlOptions:{position:b.ControlPosition.BOTTOM_RIGHT},zoomControl:!0,zoomControlOptions:{style:b.ZoomControlStyle.SMALL},zoom:f},c!==g&&a.mix(h,{streetViewControl:!1}),a.mix(h,n,!0),h},_initMapEvent:function(){var a=this,b=a.get("map");c===f?a.addListener(b,"tilesloaded",function(){a.fire("load")}):a.fire("load")},_initInfoWindow:function(){var b=this,c=b.get("infoWindows"),d=b.get("markers");a.Array.each(c,function(a,c){var e=d[c];b.addListener(e,"click",function(){b.openInfoWindow(c)})})},openInfoWindow:function(b){var d=this,e=d.get("map"),f=d.get("infoWindows"),h=d.get("markers");a.Array.each(f,function(a,d){d===b?c===g?(a.setMap(e),a.setPosition(h[d]),window.setTimeout(function(){a.open()},200)):a.open(e,h[d]):a.close()})},closeInfoWindow:function(a){var b=this.get("infoWindows");0>a||a>=b.length||this.get("infoWindows")[a].close()},_defLoadFn:function(){this.drawMarkers()},subscribe:function(a,b){return this.addListener(this.get("map"),a,b)},addListener:function(a,c,d){b.event.addListener(a,c,d)},drawMarkers:function(){var b=this;a.Array.each(b.get("markers"),function(a){a.setMap(b.get("map"))})},deleteMarkers:function(){var b=this;a.Array.each(b.get("markers"),function(a){a.setMap(null)}),b.set("markers",[])},_setBounds:function(c){if(!c)return null;var d=new b.LatLngBounds;return a.Array.each(c,function(a){a instanceof b.Marker&&d.extend(a.getPosition())}),d},_setCenter:function(a){var c=this.get("map");return c&&(a instanceof b.LatLng?c.setCenter(a):e(a)&&2===a.length&&c.setCenter(new b.LatLng(a[0],a[1]))),a},_getCenter:function(a){var b=this.get("map");return b?b.getCenter():a},_validateZoom:function(a){return/^\d+$/.test(a)},_setZoom:function(a){var b=this.get("map");return b&&(c===g?b.setZoomLevel(a):b.setZoom(a)),a},_getZoom:function(a){var b=this.get("map");return b?c===g?b.getZoomLevel():b.getZoom():a},_setMarkers:function(c){var d=[];return a.Array.each(c,function(a){var c={position:new b.LatLng(a.position[0],a.position[1])};a.title&&(c.title=a.title),d.push(new b.Marker(c))}),d},_setInfoWindows:function(c){var d=[];return a.Array.each(c,function(a){var c=null;a&&(c=new b.InfoWindow({content:a})),d.push(c)}),d}};a.extend(h,a.Base,i),a.mt.Map=h},"1.0.0",{requires:["mt-base","base-base","node"]});