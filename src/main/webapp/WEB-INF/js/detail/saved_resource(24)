M.add("w-carousel",function(a){var b=a.Lang,c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",d={value:null,setter:function(a){return this.get("contentBox").one(a)}},e="widget-carousel",f={prev:e+"-nav-prev",next:e+"-nav-next",indicators:e+"-indicators",indicatorList:e+"-indicator-list",previews:e+"-previews"},g={ndCarousel:d,ndIndicatorWrap:d,indicatorWrapWidth:{value:null},nlCarouselItems:{value:null},hideCarousel:{value:!0},toggleCarousel:{value:!0},showCarouselNav:{value:!0},index:{value:-1},indicatorMargin:{value:0},fillLastPage:{value:!1},slideSpeed:{value:.2},getCarouselSrc:{value:null}},h={navs:'<a href="#" hidefocus="true" class="widget-carousel-nav-link  widget-carousel-nav-prev prev"></a><a href="#" hidefocus="true" class="widget-carousel-nav-link widget-carousel-nav-next next"></a>',carouselItem:'<img src="'+c+'" data-idx="{index}" />'};a.namespace("mt.widget");var i=a.Base.create("carousel",a.Widget,[],{initializer:function(){var a=(this.get("ndCarousel"),this.get("ndIndicatorWrap")),b=a.one("> ul"),c=b.all("> li"),d=c.size(),e=c.item(0),f=parseInt(e.getStyle("marginRight"),10),g=e.get("offsetWidth")+f,h=(this.get("indicatorWrapWidth")||a.get("offsetWidth"))+f,i=Math.floor(h/g),j=i*g,k=Math.ceil(d/i),l=g*d,m=0;this.get("fillLastPage")&&(m=h-(d-(k-1)*i)*g),this.set("ndIndicatorList",b),this.set("nlIndicators",c),this.set("indicatorCount",d),this.set("visiableCount",i),this.set("itemPageWidth",j),this.set("totalPage",k),this.set("extraPageWidth",m),this.set("totalWidth",l),this._pageShift=0},renderUI:function(){this._renderIndicators(),this._renderCarousel()},bindUI:function(){this._bindIndicatorEvents(),this._bindCarouselEvents()},syncUI:function(){var a,b=this.get("index");return 0>b?void this.set("page",1):(a=this._getPageFromIndex(b),this.set("index",b),void this.set("page",a))},_renderIndicators:function(){var a=this.get("nlIndicators"),b=this.get("ndIndicatorList"),c=this.get("ndIndicatorWrap");a.isEmpty()||(a.each(function(a,b){a.setData("idx",b)}),c.addClass(i.CSS_NAME.indicators),b.addClass(i.CSS_NAME.indicatorList),b.setStyles({width:this.get("totalWidth")}),c.appendChild(i.TEMPLATE.navs))},_renderCarousel:function(){var a=this.get("ndCarousel");a&&(this.get("hideCarousel")&&a.hide(),a.addClass(i.CSS_NAME.previews),this.get("indicatorCount")>1&&a.appendChild(i.TEMPLATE.navs))},_bindIndicatorEvents:function(){var a=this,b=this.get("ndIndicatorWrap"),c=this.get("ndIndicatorList");b.delegate("click",function(b){var c=b.target,d=a.get("totalPage"),e=a.get("page");b.halt(),c.hasClass("next")?e++:c.hasClass("prev")&&e--,e=(e+d-1)%d+1,a.set("page",e)},".widget-carousel-nav-link"),c.delegate("click",function(b){var c=b.currentTarget,d=parseInt(c.getData("idx"),10),e=a.get("visiableCount"),f=a.get("page");b.halt(),a.set("index",d),f=a._pageShift?a.get("totalPage")-Math.floor((a.get("indicatorCount")-d-1)/e):Math.floor(d/e)+1,a.set("page",f)},"> li"),this.on("indexChange",function(b){a._toggleCurrUIState(b.newVal)},this),this.after("pageChange",this._syncIndicators,this)},_bindCarouselEvents:function(){{var a=this,b=this.get("indicatorCount"),c=this.get("ndCarousel");this.get("nlCarouselItems")}this.get("ndCarousel")&&(c.delegate("click",function(c){var d,e=c.target,f=a.get("index"),g=a.get("page");c.halt(),e.hasClass("next")?f++:e.hasClass("prev")&&f--,f=(f+b)%b,d=a._getPageFromIndex(f),d!==g&&a.set("page",d),a.set("index",f)},".widget-carousel-nav-link"),this.after("indexChange",this._syncCarousel,this))},_syncCarousel:function(){var a,c,d=this.get("nlCarouselItems"),e=this.get("ndCarousel"),f=this.get("index"),g=this.get("indicatorCount"),h="";if(!d||d.isEmpty()){for(c=0;g>c;c++)h+=b.sub(i.TEMPLATE.carouselItem,{index:c});e.appendChild(h),d=e.all("> img"),this.set("nlCarouselItems",d)}a=d.item(f),d.hide(),a.getData("rendered")||this._renderCarouselItem(a,f),a.show()},_syncIndicators:function(){var b,c=this.get("page"),d=this.get("ndIndicatorList"),e=this.get("ndIndicatorWrap"),f=this.get("itemPageWidth"),g=this.get("totalPage"),h=parseInt(d.getStyle("left"),10)||0;c===g?(this._pageShift=this.get("extraPageWidth"),e.one(".next").hide()):e.one(".next").show(),1===c?(this._pageShift=0,e.one(".prev").hide()):e.one(".prev").show(),b=(c-1)*f-this._pageShift;var i=new a.Anim({node:d,from:{left:h},to:{left:-b},duration:this.get("slideSpeed")});i.run()},_toggleCurrUIState:function(a){var b=this.get("nlIndicators"),c=this.get("ndCarousel"),d="current",e=b.item(a);return e.hasClass(d)?void(this.get("toggleCarousel")&&(e.removeClass(d),c&&c.hide())):(c&&c.show(),b.removeClass(d),void e.addClass(d))},_getPageFromIndex:function(a){var b,c=this.get("indicatorCount"),d=this.get("visiableCount"),e=this.get("totalPage");return b=this._pageShift?e-Math.ceil((c-a)/d)+1:Math.ceil((a+1)/d)},_renderCarouselItem:function(a,b){var c=a.getData("src");if(!c){var d=this.get("nlIndicators"),e=this.get("getCarouselSrc"),f=d.item(b);c=e?e(f):f.one("img").get("src")}a.set("src",c),a.setData("rendered",!0)}},{ATTRS:g,CSS_PREFIX:e,CSS_NAME:f,TEMPLATE:h});a.mt.widget.Carousel=i},"1.0.0",{requires:["mt-base","base-build","widget","anim"],skinnable:!0});